# Optimism Deployer Scripts

This directory contains scripts for deploying and upgrading Optimism contracts on Celo networks using the `op-deployer` tool.

## Prerequisites

- [op-deployer](https://github.com/celo-org/optimism/tree/op-deployer/v3.0.0/op-deployer) - Optimism deployment tool

## Environment Variables

### Required Variables
- `VERSION` - Contracts version to deploy (`v2.0.0` or `v3.0.0`)
- `NETWORK` - Target network (`alfajores`, `baklava`, or `mainnet`)
- `OP_ROOT` - Path to the Optimism repository
- `DEPLOYER_PK` - Private key of the deployer account

### Optional Variables
- `RPC_URL` - Defaults to `http://localhost:8545` (locally forked network). Change to target RPC network for on-chain deployment

## Scripts

### `bootstrap.sh`

Deploys Optimism contract implementations and creates configuration files for validator and upgrade processes.

**Features:**
- Deploys all L1 contract implementations for the specified version
- Generates `config-validator.json` with deployed contract addresses
- Generates `config-upgrade.json` for upgrade configuration
- Supports network-specific proxy addresses and configurations

**Supported Versions:**
- **v2.0.0**: Prestate hash `0x03b357b30095022ecbb44ef00d1de19df39cf69ee92a60683a6be2c6f8fe6a3e`
- **v3.0.0**: Prestate hash `0x034b32d11f017711ce7122ac71d87b1c6cc73e10a0dbd957d8b27f6360acaf8f`

**Network-Specific Configurations:**
- **alfajores**: Testnet configuration with upgradeable superchain config
- **baklava**: Testnet configuration with upgradeable superchain config  
- **mainnet**: Production configuration with non-upgradeable superchain config

**Example Execution:**
```bash
VERSION="v3.0.0" NETWORK="alfajores" OP_ROOT="/path/to/op/artifacts" DEPLOYER_PK="0x..." ./bootstrap.sh
```

### `bootstrap-validator.sh`

Deploys `StandardValidator` contract (required for superchain-ops) using the configuration generated by `bootstrap.sh`.

**Features:**
- Uses `config-validator.json` for contract addresses
- Deploys validator implementations for the specified version
- Supports both v2.0.0 and v3.0.0 versions

**Example Execution:**
```bash
VERSION="v3.0.0" NETWORK="alfajores" OP_ROOT="/path/to/op/artifacts" DEPLOYER_PK="0x..." ./bootstrap-validator.sh
```

### `upgrade.sh`

Performs the actual upgrade of L1 contracts to the specified version.

**Features:**
- Uses `config-upgrade.json` for upgrade configuration
- Supports different upgrade flows for v2.0.0 and v3.0.0
- Handles network-specific upgrade parameters

**Example Execution:**
```bash
VERSION="v3.0.0" NETWORK="alfajores" OP_ROOT="/path/to/op/artifacts" DEPLOYER_PK="0x..." ./upgrade.sh
```

### `run_upgrade.sh`

Orchestrates the complete upgrade process by running all scripts in sequence.

**Features:**
- Automatically sets network-specific multisig addresses
- Provides fallback to default Anvil deployer key if not specified
- Runs bootstrap, bootstrap-validator, and upgrade scripts in order

**Network Multisig Addresses:**
- **alfajores**: `0xf05f102e890E713DC9dc0a5e13A8879D5296ee48`
- **baklava**: `0xd542f3328ff2516443FE4db1c89E427F67169D94`
- **mainnet**: `0x4092A77bAF58fef0309452cEaCb09221e556E112`

**Example Execution:**
```bash
VERSION="v3.0.0" NETWORK="alfajores" OP_ROOT="/path/to/op/artifacts" ./run_upgrade.sh
```

## Configuration Files

### `config-validator.json`

Contains deployed contract addresses for validator operations. Generated automatically by `bootstrap.sh`.

**Key Fields:**
- `release` - Optimism version
- `challenger` - Address of the challenger contract
- `l1PAOMultisig` - L1 Proxy Admin Owner multisig address
- Various implementation addresses for L1 contracts

### `config-upgrade.json`

Contains configuration for contract upgrades. Generated automatically by `bootstrap.sh`.

**Key Fields:**
- `prank` - Address to impersonate for upgrades
- `opcm` - Optimism Chain Manager address
- `chainConfigs` - Array of chain-specific upgrade configurations
- `upgradeSuperchainConfig` - Whether to upgrade superchain config

## Usage Workflow

1. **Export necessary env vars:**
   ```bash
   export VERSION="v3.0.0"
   export NETWORK="alfajores"
   export OP_ROOT="/path/to/optimism"
   export DEPLOYER_PK="your_private_key"
   ```

2. **Run complete upgrade:**
   ```bash
   ./run_upgrade.sh
   ```

## Network Support

| Network | Chain ID | Environment | Superchain Config Upgradeable |
|---------|----------|-------------|------------------------------|
| alfajores | 44787 | Testnet | Yes |
| baklava | 62320 | Testnet | Yes |
| mainnet | 42220 | Production | No |

## Notes

- The `run_upgrade.sh` script provides a safe default Anvil private key for local testing
- Network-specific configurations are automatically applied based on the `NETWORK` environment variable
- Contract addresses are deterministic and network-specific
