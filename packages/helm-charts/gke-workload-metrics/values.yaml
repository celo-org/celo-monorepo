# Combination of pod labels and endpoints on which to scrape.
# TODO: simplify this config by adding a 'metric' port to each pod of interest

# Which cluster to monitor
cluster: alfajores

# Where the podmonitor will be installed.
namespace: prometheus

# TODO: enable when kube state metrics pods have port names
# kubeStateMetrics:
#   enabled: true

targets:
  - suffix: attestation-service
    labels:
      app: attestation-service
    endpoints:
      - port: http
        path: /metrics

  - suffix: blockscout
    labels:
      app: blockscout
      component: blockscout-api
    endpoints:
      - port: http
        path: /metrics/web  # Web & API
      - port: health
        path: /metrics/indexer  # Indexer
 
  - suffix: eksportisto
    labels:
      app: eksportisto
    endpoints:
      - port: prometheus
        path: /metrics

  - suffix: testnet
    labels:
      app: testnet
    endpoints:
      - port: pprof
        path: /debug/metrics/prometheus
      - port: metrics
        path: /debug/metrics/prometheus

  - suffix: walletconnect
    labels:
      app.kubernetes.io/name: walletconnect
    endpoints:
      - port: http
        path: /metrics
    namespace: walletconnect

relabels:
  - sourceLabels: [__name__]
    regex: (apiserver|etcd|erlang|kube|kubelet|nginx|phoenix|rest_client|state|storage)_.*
    action: drop
