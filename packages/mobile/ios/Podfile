source 'https://cdn.cocoapods.org/'

platform :ios, "9.0"

# Allow using RNFirebase as static frameworks
# https://rnfirebase.io/#allow-ios-static-frameworks
# Otherwise we get the following error:
# `The 'Pods-celo' target has transitive dependencies that include statically linked binaries [...]`
$RNFirebaseAsStaticFramework = true

require_relative "../../../node_modules/@react-native-community/cli-platform-ios/native_modules"

target "celo" do
  use_frameworks!

  # React Native Core pods
  pod "FBLazyVector", :path => "../../../node_modules/react-native/Libraries/FBLazyVector"
  pod "FBReactNativeSpec", :path => "../../../node_modules/react-native/Libraries/FBReactNativeSpec"
  pod "RCTRequired", :path => "../../../node_modules/react-native/Libraries/RCTRequired"
  pod "RCTTypeSafety", :path => "../../../node_modules/react-native/Libraries/TypeSafety"
  pod "React", :path => "../../../node_modules/react-native/"
  pod "React-Core", :path => "../../../node_modules/react-native/"
  pod "React-CoreModules", :path => "../../../node_modules/react-native/React/CoreModules"
  pod "React-Core/DevSupport", :path => "../../../node_modules/react-native/"
  pod "React-RCTActionSheet", :path => "../../../node_modules/react-native/Libraries/ActionSheetIOS"
  pod "React-RCTAnimation", :path => "../../../node_modules/react-native/Libraries/NativeAnimation"
  pod "React-RCTBlob", :path => "../../../node_modules/react-native/Libraries/Blob"
  pod "React-RCTImage", :path => "../../../node_modules/react-native/Libraries/Image"
  pod "React-RCTLinking", :path => "../../../node_modules/react-native/Libraries/LinkingIOS"
  pod "React-RCTNetwork", :path => "../../../node_modules/react-native/Libraries/Network"
  pod "React-RCTSettings", :path => "../../../node_modules/react-native/Libraries/Settings"
  pod "React-RCTText", :path => "../../../node_modules/react-native/Libraries/Text"
  pod "React-RCTVibration", :path => "../../../node_modules/react-native/Libraries/Vibration"
  pod "React-Core/RCTWebSocket", :path => "../../../node_modules/react-native/"
  pod "React-cxxreact", :path => "../../../node_modules/react-native/ReactCommon/cxxreact"
  pod "React-jsi", :path => "../../../node_modules/react-native/ReactCommon/jsi"
  pod "React-jsiexecutor", :path => "../../../node_modules/react-native/ReactCommon/jsiexecutor"
  pod "React-jsinspector", :path => "../../../node_modules/react-native/ReactCommon/jsinspector"
  pod "ReactCommon/jscallinvoker", :path => "../../../node_modules/react-native/ReactCommon"
  pod "ReactCommon/turbomodule/core", :path => "../../../node_modules/react-native/ReactCommon"
  pod "Yoga", :path => "../../../node_modules/react-native/ReactCommon/yoga"
  pod "DoubleConversion", :podspec => "../../../node_modules/react-native/third-party-podspecs/DoubleConversion.podspec"
  pod "glog", :podspec => "../../../node_modules/react-native/third-party-podspecs/glog.podspec"
  pod "Folly", :podspec => "../../../node_modules/react-native/third-party-podspecs/Folly.podspec"

  pod "react-native-geth", :path => "../../../node_modules/react-native-geth"
  pod "CeloBlockchain", :path => "../../../node_modules/@celo/client/CeloBlockchain.podspec"

  pod 'Segment-Firebase'

  target "celoTests" do
    inherit! :search_paths
  end

  use_native_modules!
end

post_install do |installer|
  installer.pods_project.targets.each do |target|
    target.build_configurations.each do |config|
      config.build_settings["ENABLE_BITCODE"] = "NO"
    end
  end

  # Include env xccconfig generated by React Native Config
  installer.aggregate_targets.each do |target|
    target.user_build_configurations.each_key do |key|
      cocoapods_xcconfig = target.xcconfig_path(key)
      rnconfig_xcconfig = target.client_root + "env.xcconfig"
      File.open(cocoapods_xcconfig, 'a') do |f|
        f.write <<~EOF
          // Env config generated by React Native Config
          #include? "#{rnconfig_xcconfig.relative_path_from(cocoapods_xcconfig.dirname)}"
        EOF
      end
    end
  end
end
