name: Run dry-run script
#on: [push]
on:
  workflow_dispatch:
    inputs:
      publish:
        description: 'Environment to deploy to'
        required: true
        type: choice
        options:
          - Y
          - N
          - dry-run
      version:
        description: 'Action to run in the workflow'
        required: true
        type: string
        default: ''

jobs:
  dry-run:
    name: Dry run
    runs-on: ["self-hosted", "monorepo-npm"]
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3

      # Setup Node JS with input from node version and set the registry url (defaults to npm registry)
      - name: 'Setup Node JS'
        uses: actions/setup-node@v3
        with:
          node-version: 12.22.12
          registry-url: https://registry.npmjs.org

      - run: |
          echo "publish=${{ github.event.inputs.publish }}" >> "$GITHUB_OUTPUT"
          echo "version=${{ github.event.inputs.version }}" >> "$GITHUB_OUTPUT"

      - run: sed -i 's/ && yarn keys:decrypt"/"/g' package.json

      - run: yarn
      - run: yarn build

      - run: |
          npm run deploy-sdks-dry-run

